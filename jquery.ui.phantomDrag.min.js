/*
* jquery.ui.phantomDrag.js
* @author ykhs <ykhs.jp@gmail.com>
*
* Copyright ykhs <ykhs.jp@gmail.com>
* Dual licensed under the MIT or GPL Version 2 licenses.
* http://jquery.org/license
*/
(function(e,d,a,c,b){e.widget("ui.phantomDrag",{options:{xmax:65536,xmin:-65536,ymax:65536,ymin:-65536,delay:13,customEasing:null,stopSpeedBorder:0.1},EVENT_DRAG_START:"phantomdrag-start",EVENT_DRAG_RELEASE:"phantomdrag-release",EVENT_DRAG_MOVE:"phantomdrag-move",EVENT_DRAG_STOP:"phantomdrag-stop",mx:0,mfx:0,my:0,mfy:0,timer:0,_init:function(){this.element.bind({mousedown:e.proxy(this._start,this)}).data("phantomdragX",0).data("phantomdragFx",0).data("phantomdragDx",0).data("phantomdragSx",0).data("phantomdragY",0).data("phantomdragFy",0).data("phantomdragDy",0).data("phantomdragSy",0)},_startTimer:function(){this.timer=b(e.proxy(this._onEnterFrame,this),16)},_stopTimer:function(){clearInterval(this.timer);this.timer=0},_start:function(g){this._stopTimer();var f=this.element.data("phantomdragX"),h=this.element.data("phantomdragY");this.element.data("phantomdragOn",true).data("phantomdragDx",f).data("phantomdragFx",f).data("phantomdragDy",h).data("phantomdragFy",h);this.mfx=c.round(g.pageX);this.mfy=c.round(g.pageY);this.element.trigger(this.EVENT_DRAG_START);e(a).bind({mousemove:e.proxy(this._move,this),mouseup:e.proxy(this._end,this)});this._startTimer();return false},_move:function(g){var h=this.options,f=this.element;if(!f.data("phantomdragMove")){f.data("phantomdragMove",true)}this.mx=c.round(g.pageX);this.my=c.round(g.pageY);f.data("phantomdragDx",c.max(h.xmin,c.min(f.data("phantomdragFx")+this.mx-this.mfx,h.xmax))).data("phantomdragDy",c.max(h.ymin,c.min(f.data("phantomdragFy")+this.my-this.mfy,h.ymax)));return false},_end:function(f){this.element.data("phantomdragOn",false).trigger(this.EVENT_DRAG_RELEASE);e(a).unbind({mousemove:this._move,mouseup:this._end})},_onEnterFrame:function(j){var r=this.element,f=this.options,h=r.data("phantomdragFx"),n=r.data("phantomdragSx"),s=r.data("phantomdragDx"),p=r.data("phantomdragX"),g=r.data("phantomdragFy"),m=r.data("phantomdragSy"),q=r.data("phantomdragDy"),l=r.data("phantomdragY"),k=null,i=f.stopSpeedBorder;n=f.customEasing?f.customEasing(p,s,n,h):(s-p)/f.delay;m=f.customEasing?f.customEasing(l,q,m,g):(q-l)/f.delay;p+=n;l+=m;k=c.abs(n)<i&&c.abs(m)<i;if(k){n=0;m=0;p=s;l=q}r.data("phantomdragX",p).data("phantomdragSx",n).data("phantomdragDx",s).data("phantomdragY",l).data("phantomdragSy",m).data("phantomdragDy",q);this.element.trigger(this.EVENT_DRAG_MOVE);if(k){this._stop()}},_stop:function(){if(!this.element.data("phantomdragOn")){this._stopTimer();this.element.trigger(this.EVENT_DRAG_STOP);this.element.data("phantomdragMove",false)}return false}})})(jQuery,this,this.document,Math,setInterval);